<div class="Box-sc-g0xbh4-0 bJMeLZ js-snippet-clipboard-copy-unpositioned" data-hpc="true"><article class="markdown-body entry-content container-lg" itemprop="text"><p align="center" dir="auto">
  <a href="https://dragonflydb.io" rel="nofollow">
    <img src="/dragonflydb/dragonfly/raw/main/.github/images/logo-full.svg" width="284" border="0" alt="蜻蜓" style="max-width: 100%;">
  </a>
</p>
<p dir="auto"><a href="https://github.com/dragonflydb/dragonfly/actions/workflows/ci.yml"><img src="https://github.com/dragonflydb/dragonfly/actions/workflows/ci.yml/badge.svg" alt="ci测试" style="max-width: 100%;"></a> <a href="https://twitter.com/dragonflydbio" rel="nofollow"><img src="https://camo.githubusercontent.com/7348bcea13cd065b10715c0202f1025420a1df1d79c5c65804c1d0825dbaecb1/68747470733a2f2f696d672e736869656c64732e696f2f747769747465722f666f6c6c6f772f647261676f6e666c796462696f3f7374796c653d736f6369616c" alt="推特网址" data-canonical-src="https://img.shields.io/twitter/follow/dragonflydbio?style=social" style="max-width: 100%;"></a></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他语言：  </font></font><a href="/dragonflydb/dragonfly/blob/main/README.zh-CN.md"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简体中文</font></font></a> <a href="/dragonflydb/dragonfly/blob/main/README.ja-JP.md"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日本语</font></font></a> <a href="/dragonflydb/dragonfly/blob/main/README.ko-KR.md"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">한국어</font></font></a></p>
<p dir="auto"><a href="https://www.dragonflydb.io/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font><a href="https://dragonflydb.io/docs" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font><a href="https://www.dragonflydb.io/docs/getting-started" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速入门</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font><a href="https://discord.gg/HsPjXGVH85" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">社区Discord</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> • </font></font><a href="https://github.com/dragonflydb/dragonfly/discussions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub 讨论</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font><a href="https://github.com/dragonflydb/dragonfly/issues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub 问题</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font><a href="https://github.com/dragonflydb/dragonfly/blob/main/CONTRIBUTING.md"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">贡献</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font><a href="https://www.dragonflydb.io/cloud" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蜻蜓云</font></font></a></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">世界上最高效的内存数据存储</font></font></h2><a id="user-content-the-worlds-most-efficient-in-memory-data-store" class="anchor-element" aria-label="永久链接：世界上最高效的内存数据存储" href="#the-worlds-most-efficient-in-memory-data-store"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 是专为现代应用程序工作负载构建的内存数据存储。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 与 Redis 和 Memcached API 完全兼容，无需更改代码即可采用。</font><font style="vertical-align: inherit;">与传统的内存数据存储相比，Dragonfly 的吞吐量提高了 25 倍，缓存命中率更高，尾部延迟更低，并且对于相同大小的工作负载，运行资源最多可减少 80%。</font></font></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></h2><a id="user-content-contents" class="anchor-element" aria-label="永久链接： 内容" href="#contents"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="#benchmarks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基准测试</font></font></a></li>
<li><a href="https://github.com/dragonflydb/dragonfly/tree/main/docs/quick-start"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速开始</font></font></a></li>
<li><a href="#configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font></font></a></li>
<li><a href="#roadmap-status"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路线图和状态</font></font></a></li>
<li><a href="#design-decisions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设计决策</font></font></a></li>
<li><a href="#background"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li>
</ul>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><a name="user-content-benchmarks"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基准测试</font></font></h2><a id="user-content-benchmarks" class="anchor-element" aria-label="永久链接：基准" href="#benchmarks"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们首先在实例上比较 Dragonfly 和 Redis </font></font><code>m5.large</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，由于其单线程架构，通常用于运行 Redis。</font><font style="vertical-align: inherit;">基准程序从同一可用区中的另一个负载测试实例 (c5n) 运行，使用</font></font><code>memtier_benchmark  -c 20 --test-time 100 -t 4 -d 256 --distinct-client-seed</code></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 显示了类似的性能：</font></font></p>
<ol dir="auto">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">套 （</font></font><code>--ratio 1:0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></li>
</ol>
<table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">雷迪斯</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DF</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS：159K，P99.9：1.16ms，P99：0.82ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS：173K，P99.9：1.26ms，P99：0.9ms</font></font></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol start="2" dir="auto">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取 ( </font></font><code>--ratio 0:1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)：</font></font></li>
</ol>
<table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">雷迪斯</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DF</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS：194K，P99.9：0.8ms，P99：0.65ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS：191K，P99.9：0.95ms，P99：0.8ms</font></font></td>
</tr>
</tbody>
</table>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的基准测试表明，DF 内部允许垂直扩展的算法层在单线程运行时不会造成太大损失。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，如果我们采用更强一点的实例（m5.xlarge），DF 和 Redis 之间的差距就会开始扩大。</font><font style="vertical-align: inherit;">( </font></font><code>memtier_benchmark  -c 20 --test-time 100 -t 6 -d 256 --distinct-client-seed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">):</font></font></p>
<ol dir="auto">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">套 （</font></font><code>--ratio 1:0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></li>
</ol>
<table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">雷迪斯</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DF</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS：190K，P99.9：2.45ms，P99：0.97ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS：279K，P99.9：1.95ms，P99：1.48</font></font></td>
</tr>
</tbody>
</table>
<ol start="2" dir="auto">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取 ( </font></font><code>--ratio 0:1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)：</font></font></li>
</ol>
<table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">雷迪斯</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DF</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS：220K，P99.9：0.98ms，P99：0.8ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS：305K，P99.9：1.03ms，P99：0.87ms</font></font></td>
</tr>
</tbody>
</table>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 吞吐能力随着实例规模不断增长，而单线程 Redis 在 CPU 上遇到瓶颈，在性能方面达到局部最大值。</font></font></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/2e9cd2606cd1706d5b411cca5d9dde4d63c2265ede5fccb1ba1a8ed758f71f5a/687474703a2f2f7374617469632e647261676f6e666c7964622e696f2f7265706f2d6173736574732f6177732d7468726f7567687075742e737667"><img src="https://camo.githubusercontent.com/2e9cd2606cd1706d5b411cca5d9dde4d63c2265ede5fccb1ba1a8ed758f71f5a/687474703a2f2f7374617469632e647261676f6e666c7964622e696f2f7265706f2d6173736574732f6177732d7468726f7567687075742e737667" width="80%" border="0" data-canonical-src="http://static.dragonflydb.io/repo-assets/aws-throughput.svg" style="max-width: 100%;"></a></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们在网络能力最强的实例 c6gn.16xlarge 上比较 Dragonfly 和 Redis，则与 Redis 单进程相比，Dragonfly 的吞吐量提高了 25 倍，超过 3.8M QPS。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 在峰值吞吐量下的第 99 个百分位数延迟指标：</font></font></p>
<table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6g</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6gn</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7g</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.8毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1毫秒</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">得到</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.9毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.9毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.8毫秒</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">塞泰克斯</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.9毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3毫秒</font></font></td>
</tr>
</tbody>
</table>
<p dir="auto"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有基准测试都是使用</font></font><code>memtier_benchmark</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（见下文）根据每个服务器和实例类型调整的线程数来执行的。</font></font><code>memtier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在单独的 c6gn.16xlarge 机器上运行。</font><font style="vertical-align: inherit;">我们将 SETEX 基准的到期时间设置为 500，以确保它能够在测试结束后继续存在。</font></font></em></p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto"><pre>  memtier_benchmark --ratio ... -t <span class="pl-k">&lt;</span>threads<span class="pl-k">&gt;</span> -c 30 -n 200000 --distinct-client-seed -d 256 \
     --expiry-range=...</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 tooltipped-no-delay d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="  memtier_benchmark --ratio ... -t <threads> -c 30 -n 200000 --distinct-client-seed -d 256 \
     --expiry-range=..." tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在管道模式下</font></font><code>--pipeline=30</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，Dragonfly 的</font><font style="vertical-align: inherit;">SET 操作达到</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10M QPS ，GET 操作达到</font></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15M QPS</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 与 Memcached</font></font></h3><a id="user-content-dragonfly-vs-memcached" class="anchor-element" aria-label="永久链接：Dragonfly 与 Memcached" href="#dragonfly-vs-memcached"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在 AWS 上的 c6gn.16xlarge 实例上将 Dragonfly 与 Memcached 进行了比较。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在延迟相当的情况下，Dragonfly 吞吐量在写入和读取工作负载方面均优于 Memcached 吞吐量。</font><font style="vertical-align: inherit;">由于</font></font><a href="/dragonflydb/dragonfly/blob/main/docs/memcached_benchmark.md"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memcached 中写入路径</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的争用，Dragonfly 在写入工作负载中表现出更好的延迟。</font></font></p>
<div class="markdown-heading" dir="auto"><h4 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设定基准</font></font></h4><a id="user-content-set-benchmark" class="anchor-element" aria-label="永久链接：SET 基准" href="#set-benchmark"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<table>
<thead>
<tr>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font></font></th>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS(千qps)</font></font></th>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟99%</font></font></th>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99.9%</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蜻蜓</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">🟩3844</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">🟩0.9 毫秒</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">🟩2.4 毫秒</font></font></td>
</tr>
<tr>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存缓存</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">806</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.6毫秒</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2毫秒</font></font></td>
</tr>
</tbody>
</table>
<div class="markdown-heading" dir="auto"><h4 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取基准测试</font></font></h4><a id="user-content-get-benchmark" class="anchor-element" aria-label="永久链接：GET 基准测试" href="#get-benchmark"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font></font></th>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QPS(千qps)</font></font></th>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟99%</font></font></th>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99.9%</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蜻蜓</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">🟩3717</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1毫秒</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4毫秒</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存缓存</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2100</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">🟩0.34 毫秒</font></font></td>
<td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">🟩0.6 毫秒</font></font></td>
</tr>
</tbody>
</table>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memcached 在读取基准测试中表现出较低的延迟，但吞吐量也较低。</font></font></p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存效率</font></font></h3><a id="user-content-memory-efficiency" class="anchor-element" aria-label="永久链接：内存效率" href="#memory-efficiency"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了测试内存效率，我们使用该命令向 Dragonfly 和 Redis 填充了约 5GB 的数据</font></font><code>debug populate 5000000 key 1024</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用 发送更新流量</font></font><code>memtier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并使用该命令启动快照</font></font><code>bgsave</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该图展示了每台服务器在内存效率方面的表现。</font></font></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e500fc70496fd11f849e383ed194b1597c797559b69fdb01ff673207657f2962/687474703a2f2f7374617469632e647261676f6e666c7964622e696f2f7265706f2d6173736574732f6267736176652d6d656d75736167652e737667"><img src="https://camo.githubusercontent.com/e500fc70496fd11f849e383ed194b1597c797559b69fdb01ff673207657f2962/687474703a2f2f7374617469632e647261676f6e666c7964622e696f2f7265706f2d6173736574732f6267736176652d6d656d75736167652e737667" width="70%" border="0" data-canonical-src="http://static.dragonflydb.io/repo-assets/bgsave-memusage.svg" style="max-width: 100%;"></a></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 在空闲状态下的内存效率比 Redis 高 30%，并且在快照阶段没有出现任何明显的内存使用增加。</font><font style="vertical-align: inherit;">在高峰期，Redis 内存使用量增加到 Dragonfly 的近 3 倍。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蜻蜓更快地完成了快照，几秒钟之内。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关 Dragonfly 内存效率的更多信息，请参阅我们的</font></font><a href="/dragonflydb/dragonfly/blob/main/docs/dashtable.md"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dashtable 文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><a name="user-content-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font></font></h2><a id="user-content-configuration" class="anchor-element" aria-label="永久链接：配置" href="#configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 在适用的情况下支持常见的 Redis 参数。</font><font style="vertical-align: inherit;">例如，您可以运行：</font></font><code>dragonfly --requirepass=foo --bind localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 目前支持以下 Redis 特定参数：</font></font></p>
<ul dir="auto">
<li><code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Redis 连接端口 ( </font></font><code>default: 6379</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)。</font></font></li>
<li><code>bind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用于</font></font><code>localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅允许本地主机连接或公共 IP 地址以允许连接</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到该 IP</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址（即也可以从外部）。</font><font style="vertical-align: inherit;">用于</font></font><code>0.0.0.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许所有 IPv4。</font></font></li>
<li><code>requirepass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：AUTH 认证的密码（</font></font><code>default: ""</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></li>
<li><code>maxmemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：数据库使用的最大内存（以人类可读字节为单位）的限制 ( </font></font><code>default: 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)。</font><font style="vertical-align: inherit;">值</font></font><code>maxmemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示</font></font><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序将自动确定其最大内存使用量。</font></font></li>
<li><code>dir</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Dragonfly Docker</font></font><code>/data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认使用该文件夹进行快照，CLI 使用</font></font><code>""</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">您可以使用</font></font><code>-v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker 选项将其映射到您的主机文件夹。</font></font></li>
<li><code>dbfilename</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：保存和加载数据库的文件名 ( </font></font><code>default: dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)。</font></font></li>
</ul>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有一些特定于 Dragonfly 的参数：</font></font></p>
<ul dir="auto">
<li>
<p dir="auto"><code>memcached_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：在 ( ) 上启用 Memcached 兼容 API 的端口</font></font><code>default: disabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p dir="auto"><code>keys_output_limit</code><font style="vertical-align: inherit;"></font><code>keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：命令( )</font><font style="vertical-align: inherit;">中返回的键的最大数量</font></font><code>default: 8192</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，这</font></font><code>keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个危险的命令。</font><font style="vertical-align: inherit;">我们截断其结果以避免在获取太多键时内存使用激增。</font></font></p>
</li>
<li>
<p dir="auto"><code>dbnum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：支持的最大数据库数量</font></font><code>select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p dir="auto"><code>cache_mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：请参阅下面</font></font><a href="#novel-cache-design"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新颖的缓存设计</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分。</font></font></p>
</li>
<li>
<p dir="auto"><code>hz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：密钥到期评估频率 ( </font></font><code>default: 100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)。</font><font style="vertical-align: inherit;">较低的频率在空闲时使用较少的 CPU，但代价是驱逐速度较慢。</font></font></p>
</li>
<li>
<p dir="auto"><code>snapshot_cron</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：使用标准 cron 语法的自动备份快照的 cron 计划表达式，粒度为分钟 ( </font></font><code>default: ""</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)。</font><font style="vertical-align: inherit;">下面是一些 cron 计划表达式示例，请随时在我们的</font></font><a href="https://www.dragonflydb.io/docs/managing-dragonfly/backups#the-snapshot_cron-flag" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中阅读有关此参数的更多信息。</font></font></p>
<table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cron 计划表达式</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>* * * * *</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每分钟</font></font></td>
</tr>
<tr>
<td><code>*/5 * * * *</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每 5 分钟一次</font></font></td>
</tr>
<tr>
<td><code>5 */2 * * *</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每 2 小时 5 分</font></font></td>
</tr>
<tr>
<td><code>0 0 * * *</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每天 00:00（午夜）</font></font></td>
</tr>
<tr>
<td><code>0 6 * * 1-5</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">周一至周五 06:00（黎明）</font></font></td>
</tr>
</tbody>
</table>
</li>
<li>
<p dir="auto"><code>primary_port_http_enabled</code><font style="vertical-align: inherit;"></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：如果( ) </font><font style="vertical-align: inherit;">，则允许在主 TCP 端口上访问 HTTP 控制台</font></font><code>default: true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p dir="auto"><code>admin_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：启用对分配端口 ( </font></font><code>default: disabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 上控制台的管理员访问。</font><font style="vertical-align: inherit;">支持 HTTP 和 RESP 协议。</font></font></p>
</li>
<li>
<p dir="auto"><code>admin_bind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：将管理控制台 TCP 连接绑定到给定地址 ( </font></font><code>default: any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)。</font><font style="vertical-align: inherit;">支持 HTTP 和 RESP 协议。</font></font></p>
</li>
<li>
<p dir="auto"><code>admin_nopass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：启用对指定端口上控制台的开放管理访问，无需身份验证令牌 ( </font></font><code>default: false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)。</font><font style="vertical-align: inherit;">支持 HTTP 和 RESP 协议。</font></font></p>
</li>
<li>
<p dir="auto"><code>cluster_mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：支持集群模式（</font></font><code>default: ""</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">目前仅支持</font></font><code>emulated</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</li>
<li>
<p dir="auto"><code>cluster_announce_ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：集群命令向客户端公布的IP。</font></font></p>
</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有流行选项的启动脚本示例：</font></font></h3><a id="user-content-example-start-script-with-popular-options" class="anchor-element" aria-label="永久链接：具有流行选项的示例启动脚本：" href="#example-start-script-with-popular-options"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto"><pre>./dragonfly-x86_64 --logtostderr --requirepass=youshallnotpass --cache_mode=true -dbnum 1 --bind localhost --port 6379 --maxmemory=12gb --keys_output_limit=12288 --dbfilename dump.rdb</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 tooltipped-no-delay d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="./dragonfly-x86_64 --logtostderr --requirepass=youshallnotpass --cache_mode=true -dbnum 1 --bind localhost --port 6379 --maxmemory=12gb --keys_output_limit=12288 --dbfilename dump.rdb" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还可以通过以下方式提供参数：</font></font></p>
<ul dir="auto">
<li><code>--flagfile &lt;filename&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：文件应每行列出一个标志，键值标志使用等号而不是空格。</font><font style="vertical-align: inherit;">标志值不需要引号。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置环境变量。</font><font style="vertical-align: inherit;">Set </font></font><code>DFLY_x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中</font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是标志的确切名称，区分大小写。</font></font></li>
</ul>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如需日志管理或 TLS 支持等更多选项，请运行</font></font><code>dragonfly --help</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><a name="user-content-roadmap-status"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路线图和状态</font></font></h2><a id="user-content-roadmap-and-status" class="anchor-element" aria-label="永久链接：路线图和状态" href="#roadmap-and-status"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 目前支持约 185 个 Redis 命令以及除</font></font><code>cas</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">几乎与 Redis 5 API 一样，Dragonfly 的下一个里程碑将是稳定基本功能并实现复制 API。</font><font style="vertical-align: inherit;">如果您需要的命令尚未实现，请提出问题。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 Dragonfly 原生复制，我们正在设计一种分布式日志格式，它将支持更高数量级的速度。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在复制功能之后，我们将继续为 Redis 版本 3-6 API 添加缺失的命令。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅我们的</font></font><a href="https://dragonflydb.io/docs/category/command-reference" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令参考</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解 Dragonfly 当前支持的命令。</font></font></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><a name="user-content-design-decisions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设计决策</font></font></h2><a id="user-content--design-decisions" class="anchor-element" aria-label="永久链接：设计决策" href="#-design-decisions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新颖的缓存设计</font></font></h3><a id="user-content-novel-cache-design" class="anchor-element" aria-label="永久链接：新颖的缓存设计" href="#novel-cache-design"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 具有单一、统一、自适应的缓存算法，该算法简单且内存高效。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过传递</font></font><code>--cache_mode=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志来启用缓存模式。</font><font style="vertical-align: inherit;">一旦启用此模式，蜻蜓就会驱逐将来最不可能偶然发现的物品，但仅限于接近极限时</font></font><code>maxmemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相对准确的到期期限</font></font></h3><a id="user-content-expiration-deadlines-with-relative-accuracy" class="anchor-element" aria-label="永久链接：相对准确的到期期限" href="#expiration-deadlines-with-relative-accuracy"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效期范围限制为约 4 年。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于毫秒精度的到期期限（PEXPIRE、PSETEX 等） ，对于大于 134217727ms（大约 37 小时）的期限</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，四舍五入到最接近的秒</font><font style="vertical-align: inherit;">，其误差小于 0.001%，对于大范围来说应该是可以接受的。</font><font style="vertical-align: inherit;">如果这不适合您的用例，请联系或提出一个问题来解释您的案例。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关 Dragonfly 到期期限和 Redis 实现之间的更详细差异，</font></font><a href="/dragonflydb/dragonfly/blob/main/docs/differences.md"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本机 HTTP 控制台和 Prometheus 兼容指标</font></font></h3><a id="user-content-native-http-console-and-prometheus-compatible-metrics" class="anchor-element" aria-label="永久链接：本机 HTTP 控制台和 Prometheus 兼容指标" href="#native-http-console-and-prometheus-compatible-metrics"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，Dragonfly 允许通过其主 TCP 端口 (6379) 进行 HTTP 访问。</font><font style="vertical-align: inherit;">没错，您可以通过 Redis 协议和 HTTP 协议连接到 Dragonfly — 服务器在连接启动期间会自动识别该协议。</font><font style="vertical-align: inherit;">继续使用您的浏览器尝试一下。</font><font style="vertical-align: inherit;">HTTP 访问目前没有太多信息，但将来会包含有用的调试和管理信息。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到 URL</font></font><code>:6379/metrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看 Prometheus 兼容的指标。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus 导出的指标与 Grafana 仪表板兼容，</font></font><a href="/dragonflydb/dragonfly/blob/main/tools/local/monitoring/grafana/provisioning/dashboards/dashboard.json"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要的！</font><font style="vertical-align: inherit;">HTTP 控制台应在安全网络内访问。</font></font><code>--http_admin_console=false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您将 Dragonfly 的 TCP 端口暴露在外部，我们建议您使用或</font><font style="vertical-align: inherit;">禁用控制台</font></font><code>--nohttp_admin_console</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><a name="user-content-background"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></h2><a id="user-content-background" class="anchor-element" aria-label="永久链接：背景" href="#background"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragonfly 最初是一个实验，旨在了解内存数据存储在 2022 年设计时会是什么样子。根据我们作为内存存储用户和云公司工程师的经验教训，我们知道我们需要保留两个Dragonfly 的关键属性：保证所有操作的原子性，以及在非常高的吞吐量下实现低亚毫秒级延迟。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的第一个挑战是如何使用当今公共云中可用的服务器充分利用 CPU、内存和 I/O 资源。</font><font style="vertical-align: inherit;">为了解决这个问题，我们使用</font></font><a href="https://en.wikipedia.org/wiki/Shared-nothing_architecture" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无共享架构</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它允许我们在线程之间划分内存存储的键空间，以便每个线程都可以管理自己的字典数据片。</font><font style="vertical-align: inherit;">我们将这些切片称为“碎片”。</font></font><a href="https://github.com/romange/helio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为无共享架构提供线程和 I/O 管理的库已在此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开源</font><font style="vertical-align: inherit;">。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了为多键操作提供原子性保证，我们利用了最新学术研究的进展。</font><font style="vertical-align: inherit;">我们选择了论文</font></font><a href="https://www.cs.umd.edu/~abadi/papers/vldbj-vll.pdf" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“VLL：主内存数据库系统的锁管理器重新设计”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来开发 Dragonfly 的事务框架。无共享架构和 VLL 的选择使我们能够在不使用互斥锁或自旋锁的情况下组合原子多键操作。是我们的 PoC 的一个重要里程碑，其性能在其他商业和开源解决方案中脱颖而出。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的第二个挑战是为新商店设计更高效的数据结构。</font><font style="vertical-align: inherit;">为了实现这一目标，我们的核心哈希表结构基于论文</font></font><a href="https://arxiv.org/pdf/2003.07302.pdf" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Dash：持久内存上的可扩展哈希”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这篇论文本身以持久内存领域为中心，与主内存存储没有直接关系，但它仍然最适用于我们的问题。</font><font style="vertical-align: inherit;">论文中提出的哈希表设计使我们能够维护 Redis 字典中存在的两个特殊属性：数据存储增长期间的增量哈希能力以及使用无状态扫描操作在更改情况下遍历字典的能力。</font><font style="vertical-align: inherit;">除了这两个属性之外，Dash 在 CPU 和内存使用方面也更加高效。</font><font style="vertical-align: inherit;">通过利用 Dash 的设计，我们能够通过以下功能进一步创新：</font></font></p>
<ul dir="auto">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效的 TTL 记录过期。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一种新颖的缓存逐出算法，可实现比 LRU 和 LFU 等其他缓存策略更高的命中率，且</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存开销为零</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一种新颖的</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无分叉</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快照算法。</font></font></li>
</ul>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们为 Dragonfly 奠定了基础并且</font></font><a href="#benchmarks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对其性能感到满意</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们就继续实现 Redis 和 Memcached 功能。</font><font style="vertical-align: inherit;">迄今为止，我们已经实现了约 185 个 Redis 命令（大致相当于 Redis 5.0 API）和 13 个 Memcached 命令。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，</font></font><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的使命是为云工作负载构建一个设计良好、超快速、经济高效的内存数据存储，利用最新的硬件进步。</font><font style="vertical-align: inherit;">我们打算解决当前解决方案的痛点，同时保留其产品 API 和主张。
</font></font></em></p>
</article></div>
